<polymer-element name='oj-paper-collection' attributes="src sortKey sortDesc">

  <template>
    <div flex horizontal center-justified layout>
      <paper-shadow >
        <core-list on-core-activate={{selectPaper}} data="{{papers | filtered(sortKey, sortDesc) }}" >
          <template>
            <div class='item {{ {selected: selected} | tokenList }}'>
              <oj-paper-row paper={{model}}></oj-paper-row>
            </div>
          </template>
        </core-list>
      </paper-shadow>
    </div>

    <core-ajax auto url={{src}} handleAs="json" response={{papers}}></core-ajax>

    <style>
      paper-shadow{
        width: 100%;
      }
      core-list{
        width: 100%;
        height: 100%;
        min-height: 800px;
      }
      .item {
        border-bottom: 1px #efefef solid;
        box-sizing: border-box;
        padding:    0 0 0 20px;
      }
    </style>

  </template>

  <script>
    Polymer({

      selectPaper: function(e){
        window.location = '/#/review/'+ e.detail.data.sha;
      },

      filtered: function(array, key, desc) {
          if (!array)
            return array;

          var keys = key.split('.');
          var sortFunction = function(a, b) {
              var x = a;
              keys.forEach( function(key) { x = x && x[key] } );
              var y = b;
              keys.forEach( function(key) { y = y && y[key] } );

              if (typeof x == "string"){
                  x = x.toLowerCase();
                  y = y.toLowerCase();
              }

              var order = ((x < y) ? -1 : ((x > y) ? 1 : 0));
              return desc ? -order : order;
          };

          return array.sort(sortFunction);
      }


    })
  </script>
</polymer-element
