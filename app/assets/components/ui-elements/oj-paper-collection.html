<polymer-element name='oj-paper-collection' attributes="src sortKey sortDesc">

  <template>
    <div flex horizontal center-justified layout>
      <paper-shadow>

        <template if="{{papers && papers.length>0}}">
            <core-list on-core-activate={{selectPaper}} data="{{papers | filtered(sortKey, sortDesc) }}" >
              <template>
                <div class='item {{ {selected: selected} | tokenList }}'>
                  <oj-paper-row paper={{model}}></oj-paper-row>
                </div>
              </template>
            </core-list>
        </template>

          <template if="{{papers && papers.length==0}}">
              <div id=empty>
                There are no papers to view.
              </div>
          </template>

      </paper-shadow>
    </div>

    <core-ajax auto url={{src}} handleAs="json" response={{papers}}></core-ajax>

    <style>
      paper-shadow{
        width: 100%;
      }
      core-list{
        width: 100%;
        height: 100%;
        min-height: 800px;
      }
      #empty {
          font-weight: 500;
          font-size: 18px;
          padding: 20px 10px;
      }
      .item {
        border-bottom: 1px #efefef solid;
        box-sizing: border-box;
        padding:    0 0 0 20px;
      }
    </style>

  </template>

  <script>
    Polymer({

      selectPaper: function(e, detail){
          this.fire('review', detail.data);
      },

      filtered: function(array, key, desc) {
          if (!array)
            return array;

          var keys = key.split('.');
          var sortFunction = function(a, b) {
              var x = a;
              keys.forEach( function(key) { x = x && x[key] } );
              var y = b;
              keys.forEach( function(key) { y = y && y[key] } );

              if (typeof x == "string"){
                  x = x.toLowerCase();
                  y = y.toLowerCase();
              }

              var order = ((x < y) ? -1 : ((x > y) ? 1 : 0));
              return desc ? -order : order;
          };

          return array.sort(sortFunction);
      }


    })
  </script>
</polymer-element
