<polymer-element name='oj-paper-row' attributes='paper'>
<template>
  <div class='row {{paper | actionForPaper}}' flex layout horizontal>
    <summary>
      <h3>{{paper.title}}</h3>
    </summary>
    <status class='action-{{paper | actionForPaper}}'>
      <p class="state">State: <span>{{paper.state | textForState}}</span></p>
      <p class="issues">Issues: <span>{{paper.pending_issues_count}}</span></p>
      <p class="role role-{{paper | roleForPaper}}">Your role: <span>{{paper.user_permissions}}</span></p>
      <a href="/vendor/assets/javascripts#/review/{{paper.sha}}" target="_self"></a>
    </status>
  </div>

  <style>
    ::host {
        margin: 0;
    }

    h3 {
    }

    .row {
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    summary {
      width: 80%;
    }

    status {
      float:        right;
      width:        20%;
      border-left:  4px solid #c0c0c0;
    }

    status p {
      font-size:   1em;
      font-weight: bolder;
      padding-left:  8px;
      padding-right: 8px;
    }

    status p.state {
        margin-top:     8px;
    }

    status p.role {
        margin-top:     8px;
        padding-top:    8px;
        padding-bottom: 8px;
        margin-bottom:  0;
    }

    status p span {
      font-weight: normal;
    }

  </style>
</template>

<script>
  Polymer({
      actionForPaper: function(paper){
          if (!paper) return;

          var has_role = function(role) { return paper.user_permissions.indexOf(role) >= 0; };

          if (has_role('submittor') && paper.pending_issues_count>1)
            return 'needs-attention';

          else if (has_role('reviewer') && paper.state=='under_review')
              return 'needs-attention';

          else if (paper.state=='rejected')
              return 'needs-attention';

          else if (paper.state=='accepted')
              return 'accepted';

          else if (has_role('submittor'))
              return 'in-process';

      },

      roleForPaper: function(paper){
        if (!paper)
            return '';
        else if (paper.user_permissions.indexOf('editor') >= 0)
            return 'editor';
        else if (paper.user_permissions.indexOf('reviewer') >= 0)
            return 'reviewer';
        else if (paper.user_permissions.indexOf('collaborator') >= 0)
            return 'author';
        else if (paper.user_permissions.indexOf('submittor') >= 0)
            return 'author';
      },

      textForState: function(state) {
        return state && state.replace(/_/g,' ').replace(/(^|\W)\w/g, function(c) { return c.toUpperCase() } );
      }
  })
</script>
</polymer-element>
