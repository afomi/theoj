<polymer-element name='oj-paper-row' attributes='paper'>
<template>
  <div class='row {{paper | classForPaper}}' flex layout horizontal>
    <summary>
      <h3>{{paper.title}}</h3>
    </summary>
    <status class='action-{{paper | classForPaper}}'>
      <p>State: <span>{{paper.state | textForState}}</span></p>
      <p>Issues: <span>{{paper.pending_issues_count}}</span></p>
      <p class="role-{{paper}}">Your role: <span>{{paper.user_permissions}}</span></p>
      <a href="/vendor/assets/javascripts#/review/{{paper.sha}}" target="_self"></a>
    </status>
  </div>

  <style>
    ::host {
        margin: 0;
    }

    h3 {

    }

    .row {
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    summary {
      width: 80%;
    }

    status {
      float:        right;
      width:        20%;
      border-left:  1px solid #efefef;
      padding-left:  8px;
      padding-right: 8px;
    }

    status p {
      font-size: 1em;
      font-weight: bolder;
    }

    status p span {
      font-weight: normal;
    }

  </style>
</template>

<script>
  Polymer({
      classForPaper: function(paper){
          if (!paper) return;

          var has_role = function(role) { return paper.user_permissions.indexOf(role) >= 0; };

          if (has_role('submittor') && paper.pending_issues_count>1)
            return 'needs-attention';

          else if (has_role('reviewer') && paper.state=='under_review')
              return 'needs-attention';

          else if (paper.state=='rejected')
              return 'needs-attention';

          else if (paper.state=='accepted')
              return 'accepted';

          else if (has_role('submittor'))
              return 'in-process';

      },
      textForState: function(state) {
        return state && state.replace(/_/g,' ').replace(/(^|\W)\w/g, function(c) { return c.toUpperCase() } );
      }
  })
</script>
</polymer-element>
