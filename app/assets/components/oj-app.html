<polymer-element name="oj-app"
                 id="oj-app"
                 on-notification={{onNotification}}
                 on-go={{onGo}}
                 on-go-default={{onGoDefault}}
                 on-review={{onReview}}>
  <template>
    <core-scaffold id='scaffold'>
      <nav>
        <core-toolbar>
          <span class="title">The Open Journal</span>
        </core-toolbar>

        <oj-main-menu id=mainmenu currentUser={{currentUser}}></oj-main-menu>

      </nav>

      <core-toolbar tool flex>
        <div flex></div>
        <core-icon id=search-icon icon=search></core-icon>
        <input id=search is="core-input" placeholder="Search"
                         on-keyup={{onSearchKeyUp}}
                >
        <oj-user-login currentUser={{currentUser}}></oj-user-login>
      </core-toolbar>

      <oj-page-router id=pages
                      on-route-changed={{onRouteChanged}}
                      currentUser={{currentUser}}
              ></oj-page-router>

      <paper-toast id=notification class="capsule core-transition core-transition-bottom" role="status" touch-action="none" tabindex="-1"></paper-toast>

    <style>

      .title {
        font-size: 25px;
      }

      :host /deep/ #mainContainer{
        background-color: white;
      }

      #notification {
        border-radius:0;
        padding-right: 60px;
        position: fixed;
        outline: none;
        z-index: 24;
        box-sizing: border-box;
      }

      #search {
          background: #6c7ee2;
          border: solid 1px white;
          border-radius: 32px;
          color: white;
          font-size: 16px;
          padding-left: 16px;
          padding-top: 4px;
          padding-bottom: 4px;
      }
      ::-webkit-input-placeholder {
          color: silver;
      }
      :-moz-placeholder { /* Firefox 18- */
          color: silver;
      }
      ::-moz-placeholder {  /* Firefox 19+ */
          color: silver;
      }
      :-ms-input-placeholder {
          color: silver;
      }

      #search-icon {
          position: relative;
          left:     340px;
          top:      1px;
      }

    </style>

    <oj-current-user on-user={{onUser}}></oj-current-user>

  </template>

  <script>
    Polymer({

      onNotification: function(event, text) {
          this.showNotification(text);
      },

      onGo: function(event, url) {
          this.$.pages.go(url);
      },

      onGoDefault: function(event) {
          this.$.pages.gotoDefault();
      },

      onReview: function(event, paper_or_id) {
          var id = paper_or_id.typed_provider_id || paper_or_id;
          var url = '/review/' + id;
          this.$.pages.go(url);
      },

      onUser: function(event, user) {
          this.currentUser = user && user.name ? user : null;
          this.$.pages.init();
      },

      onRouteChanged: function(event, detail) {
          var $menu = this.shadowRoot.querySelector('#mainmenu');
          $menu.routeChanged(detail);
      },

      onSearchKeyUp: function(event) {
          if (event.keyCode==13) {
              event.preventDefault();
              var value = this.$.search.value;
              value = value && $.trim(value);
              if (value)
                this.fire('go', '/search?q=' + encodeURIComponent(value) );
          }
      },

      showNotification: function(text) {
          console.info('Notification: ', text);
          this.$.notification.text = text;
          this.$.notification.show();
      }

    });
  </script>

</polymer-element>
