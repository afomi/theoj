<polymer-element name="stacked-pdf-page" attributes='page scale'>
  <template>

    <style>
      :host {
        background-color: white;
        display: block;
        margin-top: 20px;
        width: 100%;
        min-height: 400px;
      }
      canvas{
        width: 100%;
        height: 100%;
      }
    </style>

    <template if="{{loaded}}">
      <paper-shadow z="1">
        <canvas on-click={{fire_click}} id='can'></canvas>
      </paper-shadow>
    </template>

  </template>

  <script>
    Polymer({
      scale: 2,
      loaded: false,
      pageOffset: 20,
      domReady: function(){
        //
        // window.onResize.listen(function(e) {
        //   console.log("resize event")
        //   this.pageHeight = this.can.height;
        // }.bind(this));

        this.style.marginTop = this.pageOffset
        this.page.then(function(pageContent){
          this.loaded = true;
          this.pageContent = pageContent;
          setTimeout(this.render.bind(this), 600)
        }.bind(this))
      },
      fire_click:function(e){

        this.fire("page-clicked",{x:e.offsetX, y: e.offsetY, page: this.pageContent.pageIndex})
      },
      render: function(){
        var canvas    = this.shadowRoot.getElementById("can")
        var context   = canvas.getContext('2d');

        var viewport  = this.pageContent.getViewport(this.scale)

        canvas.width  = viewport.width
        canvas.height = viewport.height
        this.pageContent.render({canvasContext: context, viewport: viewport})
      }
    })
  </script>
</polymer-element>
